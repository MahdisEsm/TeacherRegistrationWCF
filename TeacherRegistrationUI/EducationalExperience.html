<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <link href="Content/bootstrap-rtl.css" rel="stylesheet" />
    <script src="Scripts/jquery-3.0.0.min.js"></script>
    <script src="Scripts/bootstrap.bundle.js"></script>
    <link href="Content/font-awesome.css" rel="stylesheet" />
    <link href="Content/Css/SiteCss.css" rel="stylesheet" />
    <title>EducationalExperience</title>
</head>
<body>
    <header class="d-felx justify-content-center">
        <nav class="navbar Sitenav w-75 mx-auto radius1rem shadow">
            <a class="navbar-brand font-weight-bold" href="#">
                <img src="Content/Image/logoYellow.png" width="70" height="70" class="d-inline-block align-center" alt="" loading="lazy">
                جذب مدرس دوره های تخصصی IT
            </a>
        </nav>
        <div class="w-75 mx-auto mt-3 text-center">
            <img src="Content/Image/FigmaProjectIcons/Person-blue.png" />
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <img src="Content/Image/FigmaProjectIcons/Education-Blue.png" />
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3;"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/Job.png" style="opacity: 0.2;" />
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3;"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/Teacher.png" style="opacity: 0.2;" />
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3;"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/Document.png" style="opacity: 0.2;" />
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3;"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/LikeToTeach.png" style="opacity: 0.2;" />
        </div>
    </header>

    <section class="radius1rem shadow d-felx justify-content-center w-50 mx-auto m-4 p-3">
        <div>
            <h5 class="text-secondary">سوابق تحصیلی </h5>
            <hr class="hr-leftFade" />
        </div>

        <form class="m-1 fontSmall12" id="form">
            <div id="rows">
                <div id="row1">
                    <div class="row p-0 mb-2">
                        <div class="col-md-12">
                            <p>ردیف <span id="rowNum1">1</span> : </p>
                        </div>
                        <div class="col-md-6">

                            <div class="form-group row">
                                <label for="grade" class="col-md-4 col-form-label">مقطع تحصیلی:</label>
                                <div class="col-md-8 p-0">
                                    <select class="form-control form-control-sm rounded-lg" id="grade1" name="grade">
                                    </select>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="field" class="col-md-4 col-form-label">نام رشته:</label>
                                <div class="col-md-8 p-0">
                                    <select class="form-control form-control-sm rounded-lg" id="field1" name="field">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="subField" class="col-md-4 col-form-label">گرایش:</label>
                                <div class="col-md-8 p-0">
                                    <select class="form-control form-control-sm rounded-lg" id="subField1" name="subField">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="university" class="col-md-4 col-form-label">نام دانشگاه:</label>
                                <div class="col-md-8 p-0">
                                    <input type="text" class="form-control form-control-sm rounded-lg" id="university1" name="university">
                                </div>
                            </div>

                        </div>

                        <div class="col-md-6">

                            <div class="form-group row">
                                <label for="fromDate" class="col-md-4 col-form-label">از سال:</label>
                                <div class="col-md-8 p-0">
                                    <input type="date" class="form-control form-control-sm rounded-lg" id="fromDate1" name="fromDate">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="toDate" class="col-md-4 col-form-label">تا سال:</label>
                                <div class="col-md-8 p-0">
                                    <input type="date" class="form-control form-control-sm rounded-lg" id="toDate1" name="toDate">
                                </div>
                            </div>



                            <div class="form-group row">
                                <label for="cityUniversity" class="col-md-4 col-form-label">شهر دانشگاه:</label>
                                <div class="col-md-8 p-0">
                                    <select class="form-control form-control-sm rounded-lg" id="cityUniversity1" name="cityUniversity">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="countryUniversity" class="col-md-4 col-form-label">کشور دانشگاه:</label>
                                <div class="col-md-8 p-0">
                                    <select class="form-control form-control-sm rounded-lg" id="countryUniversity1" name="countryUniversity">
                                    </select>
                                </div>
                            </div>

                        </div>

                    </div>
                    <hr class="hr-leftFade" />

                </div>

            </div>
            <div>
                <a id="addNewRow" class="btn btn-light btn-sm float-md-right">افزودن ردیف جدید <i class="fa fa-plus"></i></a>
            </div>
            <div>
                <a id="deleteLastRow" class="btn btn-light btn-sm float-md-left">حذف آخرین ردیف <i class="fa fa-minus"></i></a>
            </div>
            <br />
            <br />
            <br />

            <div class="row  d-flex justify-content-md-between" id="btnParent">
                <div class="col-md-2">
                    <button id="prevButton" class="btn btn-sm SematecTextYellow sematecBgBlue fontSmall12"><i class="fa fa-arrow-circle-o-right text-warning"></i>مرحله قبل </button>
                </div>
                <div class="col-md-2">
                    <button id="nextButton" class="btn btn-sm SematecTextYellow sematecBgBlue fontSmall12">مرحله بعد <i class="fa fa-arrow-circle-o-left text-warning"></i></button>
                </div>
            </div>



        </form>
    </section>

</body>
<script type="text/javascript">
    var getDegrees;
    var queryString = decodeURIComponent(window.location.search);

    if (queryString != "") {
        queryString = queryString.substring(1);
        var queries = queryString.split("&");
        var personID = queries[0];
    }

    var rowid = 1;
    getDropDownValues();



    //-----------------------------------Add Or Delete New Rows Operation--------------------------------------------



    $("#addNewRow").click(function (e) {
        rowid = rowid + 1;
        debugger;
        var cln = $("#row1").clone();
        cln.attr('id', 'row' + rowid);
        $("#rows").append(cln);
        $("#row" + rowid + " " + "#rowNum1").html(rowid);
        $("#row" + rowid + " " + "#grade1").attr('id', 'grade' + rowid);
        $("#row" + rowid + " " + "#field1").attr('id', 'field' + rowid);
        $("#row" + rowid + " " + "#subField1").attr('id', 'subField' + rowid);
        $("#row" + rowid + " " + "#university1").attr('id', 'university' + rowid);
        $("#row" + rowid + " " + "#fromDate1").attr('id', 'fromDate' + rowid);
        $("#row" + rowid + " " + "#toDate1").attr('id', 'toDate' + rowid);
        $("#row" + rowid + " " + "#cityUniversity1").attr('id', 'cityUniversity' + rowid);
        $("#row" + rowid + " " + "#countryUniversity1").attr('id', 'countryUniversity' + rowid);
        getDropDownValues();
    });
    $("#deleteLastRow").click(function (e) {
        debugger;
        if (rowid > 1) {
            $("#rows").find("#row" + rowid).remove();
            rowid = rowid - 1;
        }

    });
    //-----------------------------------------getDropDownValuesFunction----------------------------------------

    function getDropDownValues() {
        debugger;
        $('#grade' + rowid).text(' ');
        $('#field' + rowid).text(' ');
        $('#subfield' + rowid).text(' ');
        $('#university' + rowid).val(' ');
        $('#fromDate' + rowid).text(' ');
        $('#toDate' + rowid).text(' ');
        $('#cityUniversity' + rowid).text(' ');
        $('#countryUniversity' + rowid).text(' ');

        $.ajax({
            url: 'http://localhost:60404/RegistrationService.svc/GetAllCity',
            type: "get",
            async: false,
            success: function (data) {
                data.forEach(function (e) {
                    $('#cityUniversity' + rowid).append($('<Option />').val(e.ID).text(e.Name));
                });
            },
            error: function () {
                connectionError();
            }
        });

        $.ajax({
            url: 'http://localhost:60404/RegistrationService.svc/GetAllCountry',
            type: "get",
            async: false,
            success: function (data) {
                data.forEach(function (e) {
                    $('#countryUniversity' + rowid).append($('<Option />').val(e.ID).text(e.Name));
                });
            },
            error: function () {
                connectionError();
            }
        });

        $.ajax({
            url: 'http://localhost:60404/RegistrationService.svc/GetAllGrade',
            type: "get",
            async: false,
            success: function (data) {
                data.forEach(function (e) {
                    $('#grade' + rowid).append($('<Option />').val(e.ID).text(e.Name));
                });
            },
            error: function () {
                connectionError();
            }
        });

        $.ajax({
            url: 'http://localhost:60404/RegistrationService.svc/GetAllField',
            type: "get",
            async: false,
            success: function (data) {
                data.forEach(function (e) {
                    $('#field' + rowid).append($('<Option />').val(e.ID).text(e.Name));
                });
            },
            error: function () {
                connectionError();
            }
        });


        $('#field' + rowid).on('change', function (e) {
            debugger;
            var subfieldElem = e.target.parentElement.parentElement.nextElementSibling.lastElementChild.firstElementChild;
            var SelectedfieldID = e.target.value;
            $.ajax({
                url: "http://localhost:60404/RegistrationService.svc/GetAllSubField",
                type: "get",
                data: { fieldID: SelectedfieldID },
                async: false,
                success: function (data) {
                    subfieldElem.innerHTML = ' ';
                    data.forEach(function (e) {
                        debugger;
                        var opt = document.createElement('option');
                        opt.value = e.ID;
                        opt.appendChild(document.createTextNode(e.Name));
                        //subfieldElem.append($('<Option />').val(e.ID).text(e.Name));
                        subfieldElem.appendChild(opt);
                    });

                },
                error: function () {
                    connectionError();
                }
            });

        });
    }
    //-----------------------------------loadData--------------------------------------------------------------------
    $.get('http://localhost:60404/RegistrationService.svc/GetEducationalExperience', { personID: personID })
        .done(function (data) {
            debugger;
            getDegrees = data.GetEducationalExperienceResult;
            for (var i = 0; i < data.GetEducationalExperienceResult.length; i++) {
                if (i > 0) {
                    $("#addNewRow").trigger("click");
                }

                $('#grade' + rowid).val(data.GetEducationalExperienceResult[i].GradeID);
                $('#field' + rowid).val(data.GetEducationalExperienceResult[i].FieldID);
                $('#field' + rowid).trigger("change");
                $('#subField' + rowid).val(data.GetEducationalExperienceResult[i].SubFieldID);
                $('#university' + rowid).val(data.GetEducationalExperienceResult[i].University);
                $('#cityUniversity' + rowid).val(data.GetEducationalExperienceResult[i].CityID);
                $('#countryUniversity' + rowid).val(data.GetEducationalExperienceResult[i].CountryID);
                $('#fromDate' + rowid).val(data.GetEducationalExperienceResult[i].FromDate);
                $('#toDate' + rowid).val(data.GetEducationalExperienceResult[i].ToDate);

            }

        });
     //-----------------------------------------------PrevButtonEvent------------------------
    $('#prevButton').click(function (e) {
        debugger;
        e.preventDefault();
        e.stopPropagation();
        location = '/PersonalInfo.html?' + personID;
    });

    //----------------------------------------SendToServer-------------------------------------

    $('#nextButton').click(function (e) {
        var error = 0;
        e.preventDefault();
        debugger;

        var degrees = [];
        for (var i = 1; i < rowid + 1; i++) {
            var Degree = {};
            Degree.ID = 0
            Degree.PersonID = personID;
            Degree.GradeID = $('#grade' + i).val();
            Degree.FieldID = $('#field' + i).val();
            Degree.SubFieldID = $('#subField' + i).val();
            Degree.University = $('#university' + i).val();
            Degree.CityID = $('#cityUniversity' + i).val();
            Degree.CountryID = $('#countryUniversity' + i).val();
            Degree.FromDate = $('#fromDate' + i).val();
            Degree.ToDate = $('#toDate' + i).val();
            degrees.push(Degree);
        }
        //--------------delete-------------------------------

        $.ajax({
            type: "GET",
            url: "http://localhost:60404/RegistrationService.svc/DeleteByPersonID",
            data: { personID: personID },
            error: function (jqXHR, textStatus, errorMessage) {
                debugger;
                console.log(jqXHR + '     ' + textStatus + '    ' + errorMessage);
                alert("درخواست شما موفقیت آمیز نبود");
                error += 1;
                return;

            },
            success: function (data) {
                debugger;
                console.log(data);
                $.ajax({
                    type: "POST",
                    url: "http://localhost:60404/RegistrationService.svc/SubmitEducationalExperience",
                    data: JSON.stringify({ degrees: degrees }),
                    contentType: "application/json",
                    dataType: "json",
                    error: function (jqXHR, textStatus, errorMessage) {
                        debugger;
                        console.log(jqXHR + '     ' + textStatus + '    ' + errorMessage);
                        alert("درخواست شما موفقیت آمیز نبود");
                        error += 1;
                        return;

                    },
                    success: function (data) {
                        debugger;
                        console.log(data);
                        if (error == 0) {
                            location = '/WorkExperience.html?' + personID;
                        }
                    }

                });

            }

        });





    });


</script>



</html>
