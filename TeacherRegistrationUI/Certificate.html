<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <link href="Content/bootstrap-rtl.css" rel="stylesheet" />
    <script src="Scripts/jquery-3.0.0.min.js"></script>
    <script src="Scripts/bootstrap.bundle.js"></script>
    <link href="Content/font-awesome.css" rel="stylesheet" />
    <link href="Content/Css/SiteCss.css" rel="stylesheet" />
    <title>Certificate</title>
</head>
<body>
    <header class="d-felx justify-content-center">
        <nav class="navbar Sitenav w-75 mx-auto radius1rem shadow">
            <a class="navbar-brand font-weight-bold" href="#">
                <img src="Content/Image/logoYellow.png" width="70" height="70" class="d-inline-block align-center" alt="" loading="lazy">
                جذب مدرس دوره های تخصصی IT
            </a>
        </nav>
        <div class="w-75 mx-auto mt-3 text-center">
            <img src="Content/Image/FigmaProjectIcons/Person-blue.png" />
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <i class="fa fa-circle" style="font-size: 6px; color: #133889;"></i>
            <img src="Content/Image/FigmaProjectIcons/Education-Blue.png" />
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889;"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/Job-Blue.png" />
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889;"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/Teacher-Blue.png" />
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889;"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <i class="fa fa-circle" style="color: #133889; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/Document-Blue.png" />
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3;"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <i class="fa fa-circle text-black-50" style="opacity: 0.3; font-size: 6px"></i>
            <img src="Content/Image/FigmaProjectIcons/LikeToTeach.png" style="opacity: 0.2;" />
        </div>
    </header>

    <section class="radius1rem shadow d-felx justify-content-center w-50 mx-auto m-4 p-3">
        <div>
            <h5 class="text-secondary">مدارک اخذ شده(عادی/بین المللی) </h5>
            <hr class="hr-leftFade" />
        </div>

        <form class="m-1 fontSmall12" id="form">
            <div id="rows" class="m-3">
                <div id="row1">
                    <div class="row">
                        <div class="col-md-12">
                            <p>ردیف <span id="rowNum1">1</span> : </p>
                        </div>
                        <div class="col-md-6">

                            <div class="form-group row">
                                <label for="certificateName" class="col-md-4 col-form-label">نام مدرک:</label>
                                <div class="col-md-8 p-0">
                                    <input type="text" class="form-control form-control-sm rounded-lg" id="certificateName1" name="certificateName" />
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="certificateDate" class="col-md-4 col-form-label">تاریخ دریافت مدرک:</label>
                                <div class="col-md-8 p-0">
                                    <input type="date" class="form-control form-control-sm rounded-lg" id="certificateDate1" name="certificateDate" />

                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="institude" class="col-md-4 col-form-label">موسسه صادرکننده:</label>
                                <div class="col-md-8 p-0">
                                    <input type="text" class="form-control form-control-sm rounded-lg" id="institude1" name="institude" />
                                </div>
                            </div>
                            <fieldset class="form-group row">
                                <div class="row col-md-12">
                                    <legend class="col-form-label col-md-5 pt-0">آیا قابل ارائه است؟:</legend>
                                    <div class="form-check form-check-inline col-md-2">
                                        <input class="form-check-input" type="radio" name="isExist1" id="isExistTrue1" value="1">
                                        <label class="form-check-label" for="isExistTrue">بله</label>
                                    </div>
                                    <div class="form-check form-check-inline col-md-2">
                                        <input class="form-check-input" type="radio" name="isExist1" id="isExistFalse1" value="0">
                                        <label class="form-check-label" for="isExistFalse">خیر</label>
                                    </div>

                                </div>
                            </fieldset>

                        </div>

                        <div class="col-md-6">
                            <div class="form-group row">
                                <label for="urlCertLink" class="col-md-4 col-form-label">لینک کنترل آنلاین(در صورت وجود):</label>
                                <div class="col-md-8 p-0">
                                    <input type="text" class="form-control form-control-sm rounded-lg" id="urlCertLink1" name="urlCertLink" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="certCountry" class="col-md-4 col-form-label">کشور صادر کننده:</label>
                                <div class="col-md-8 p-0">
                                    <select class="form-control form-control-sm rounded-lg" id="certCountry1" name="certCountry">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-form-label col-md-4">تصویر مدرک(در صورت وجود):</label>
                                <input type="file" class="col-md-8" id="certFile1">
                            </div>
                            <fieldset class="form-group row">
                                <div class="row col-md-12">
                                    <legend class="col-form-label col-md-5 pt-0">نسخه کاغذی دارد؟:</legend>
                                    <div class="form-check form-check-inline col-md-2">
                                        <input class="form-check-input" type="radio" name="isPaper1" id="isPaperTrue1" value="1">
                                        <label class="form-check-label" for="isPaperTrue">بله</label>
                                    </div>
                                    <div class="form-check form-check-inline col-md-2">
                                        <input class="form-check-input" type="radio" name="isPaper1" id="isPaperFalse1" value="0">
                                        <label class="form-check-label" for="isPaperFalse">خیر</label>
                                    </div>

                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <hr class="hr-leftFade" />

                </div>

            </div>
            <div>
                <a id="addNewRow" class="btn btn-light btn-sm float-md-right">افزودن ردیف جدید <i class="fa fa-plus"></i></a>
            </div>
            <div>
                <a id="deleteLastRow" class="btn btn-light btn-sm float-md-left">حذف آخرین ردیف <i class="fa fa-minus"></i></a>
            </div>
            <br />
            <br />
            <br />
            <div class="row  d-flex justify-content-md-between" id="btnParent">
                <div class="col-md-2">
                    <button id="prevButton" class="btn btn-sm SematecTextYellow sematecBgBlue fontSmall12"><i class="fa fa-arrow-circle-o-right text-warning"></i>مرحله قبل </button>
                </div>
                <div class="col-md-2">
                    <button id="nextButton" class="btn btn-sm SematecTextYellow sematecBgBlue fontSmall12">مرحله بعد <i class="fa fa-arrow-circle-o-left text-warning"></i></button>
                </div>
            </div>


        </form>
    </section>


</body>
<script type="text/javascript">
    //certificateName
    //certificateDate
    //institude
    //isExistTrue
    //isExistFalse
    //urlCertLink
    //certCountry
    //certFile
    //isPaperTrue
    //isPaperFalse
    var certFile = [];
    var queryString = decodeURIComponent(window.location.search);

    if (queryString != "") {
        queryString = queryString.substring(1);
        var queries = queryString.split("&");
        var personID = queries[0];
    }
    var rowid = 1;
    getDropDownValues();
    $("#addNewRow").click(function (e) {
        rowid = rowid + 1;
        debugger;
        var cln = $("#row1").clone();
        cln.attr('id', 'row' + rowid);
        $("#rows").append(cln);
        $("#row" + rowid + " " + "#rowNum1").html(rowid);
        $("#row" + rowid + " " + "#certificateName1").attr('id', 'certificateName' + rowid);
        $("#row" + rowid + " " + "#certificateDate1").attr('id', 'certificateDate' + rowid);
        $("#row" + rowid + " " + "#institude1").attr('id', 'institude' + rowid);
        $("#row" + rowid + " " + "#isExistTrue1").attr('name', 'isExist' + rowid);
        $("#row" + rowid + " " + "#isExistFalse1").attr('name', 'isExist' + rowid);
        $("#row" + rowid + " " + "#isExistTrue1").attr('id', 'isExistTrue' + rowid);
        $("#row" + rowid + " " + "#isExistFalse1").attr('id', 'isExistFalse' + rowid);
        $("#row" + rowid + " " + "#urlCertLink1").attr('id', 'urlCertLink' + rowid);
        $("#row" + rowid + " " + "#certCountry1").attr('id', 'certCountry' + rowid);
        $("#row" + rowid + " " + "#certFile1").attr('id', 'certFile' + rowid);
        $("#row" + rowid + " " + "#isPaperTrue1").attr('name', 'isPaper' + rowid);
        $("#row" + rowid + " " + "#isPaperFalse1").attr('name', 'isPaper' + rowid);
        $("#row" + rowid + " " + "#isPaperTrue1").attr('id', 'isPaperTrue' + rowid);
        $("#row" + rowid + " " + "#isPaperFalse1").attr('id', 'isPaperFalse' + rowid);
        

        $('#certificateName' + rowid).val(' ');
        $('#certificateDate' + rowid).val(' ');
        $('#institude' + rowid).val(' ');
        $('#isExistTrue' + rowid).prop('checked', false);
        $('#isExistFalse' + rowid).prop('checked', false);
        $('#urlCertLink' + rowid).val(' ');
        $('#certCountry' + rowid).text(' ');
        $('#certFile' + rowid).text(' ');
        $('#isPaperTrue' + rowid).prop('checked', false);
        $('#isPaperFalse' + rowid).prop('checked', false);
        getDropDownValues();
    });

    $("#deleteLastRow").click(function (e) {
        debugger;
        if (rowid > 1) {
            $("#rows").find("#row" + rowid).remove();
            rowid = rowid - 1;
        }

    });
    //-----------------------------------------getDropDownValuesFunction----------------------------------------

    function getDropDownValues() {
        debugger;

        $.ajax({
            url: 'http://localhost:60404/RegistrationService.svc/GetAllCountry',
            type: "get",
            async: false,
            success: function (data) {
                data.forEach(function (e) {
                    $('#certCountry' + rowid).append($('<Option />').val(e.ID).text(e.Name));
                });
            },
            error: function () {
                connectionError();
            }
        });
        $('#certFile' + rowid).on('change', function (evt) {
            debugger;
            var tgt = evt.target;
            var files = tgt.files;
            if (files.length == 0) {
                return;
                certFile[rowid-1] = null;
            }
            var fileReader = new FileReader();
            fileReader.onload = function () {
                certFile[rowid-1] = fileReader.result;
            };
            fileReader.readAsDataURL($('#certFile' + rowid).prop('files')[0]);
        });

    }
    //-----------------------------------loadData--------------------------------------------------------------------
    $.get('http://localhost:60404/RegistrationService.svc/GetCertificate', { personID: personID })
        .done(function (data) {
            debugger;
            for (var i = 0; i < data.GetCertificateResult.length; i++) {
                if (i > 0) {
                    $("#addNewRow").trigger("click");
                }
                $('#certificateName' + rowid).val(data.GetCertificateResult[i].Name);
                $('#certificateDate' + rowid).val(data.GetCertificateResult[i].Date);
                $('#institude' + rowid).val(data.GetCertificateResult[i].Institude);
                if (data.GetCertificateResult[i].IsAvailable == true) {
                    $('#isExistTrue' + rowid).prop('checked', true);
                } else {
                    $('#isExistFalse' + rowid).prop('checked', true);
                }
                $('#urlCertLink' + rowid).val(data.GetCertificateResult[i].OnlineLink);
                $('#certCountry' + rowid).val(data.GetCertificateResult[i].CountryID);
                certFile[rowid-1] = data.GetCertificateResult[i].CertPic;
                if (data.GetCertificateResult[i].HasPaper == true) {
                    $('#isPaperTrue' + rowid).prop('checked', true);
                } else {
                    $('#isPaperFalse' + rowid).prop('checked', true);
                }

            }

        });
       //-----------------------------------------------PrevButtonEvent------------------------
    $('#prevButton').click(function (e) {
        debugger;
        e.preventDefault();
        e.stopPropagation();
        location = '/TeachingExperience.html?' + personID;
    });
    //----------------------------------------SendToServer-------------------------------------

    $('#nextButton').click(function (e) {
        var error = 0;
        e.preventDefault();
        debugger;

        var certificates = [];
        for (var i = 1; i < rowid + 1; i++) {
            var Certificate = {};
            Certificate.ID = 0;
            Certificate.PersonID = personID;
            Certificate.Name = $('#certificateName' + i).val();
            Certificate.Date = $('#certificateDate' + i).val();
            Certificate.Institude = $('#institude' + i).val();
            if ($('#isExistTrue' + i).prop('checked') == true) {
                Certificate.IsAvailable = true;
            } else {
                Certificate.IsAvailable = false;
            }
            Certificate.OnlineLink=$('#urlCertLink' + i).val();
            Certificate.CountryID = $('#certCountry' + i).val();
            Certificate.CertPic = certFile[i-1];
            if ($('#isPaperTrue' + i).prop('checked') == true) {
                Certificate.HasPaper = true;
            } else {
                Certificate.HasPaper = false;
            }
           
            certificates.push(Certificate);
        }
        //--------------delete OLD Data-----------------------------

        $.ajax({
            type: "GET",
            url: "http://localhost:60404/RegistrationService.svc/DeleteCertificateByPersonID",
            data: { personID: personID },
            error: function (jqXHR, textStatus, errorMessage) {
                debugger;
                console.log(jqXHR + '     ' + textStatus + '    ' + errorMessage);
                alert("درخواست شما موفقیت آمیز نبود");
                error += 1;
                return;

            },
            success: function (data) {
                debugger;
                console.log(data);
                $.ajax({
                    type: "POST",
                    url: "http://localhost:60404/RegistrationService.svc/SubmitCertificate",
                    data: JSON.stringify({ certificates: certificates }),
                    contentType: "application/json",
                    dataType: "json",
                    error: function (jqXHR, textStatus, errorMessage) {
                        debugger;
                        console.log(jqXHR + '     ' + textStatus + '    ' + errorMessage);
                        alert("درخواست شما موفقیت آمیز نبود");
                        error += 1;
                        return;

                    },
                    success: function (data) {
                        debugger;
                        console.log(data);
                        if (error == 0) {
                            location = '/favoriteCourse.html?' + personID;
                        }
                    }

                });

            }

        });


    });


</script>



</html>
